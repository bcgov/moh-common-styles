<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>moh-common-lib</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/stripe.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">moh-common-lib</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>ReadOnlyFields</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#readme" role="tab" id="readme-tab" data-toggle="tab" data-link="readme">Design Guidelines</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/common/lib/components/address/address.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#address">address</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#city">city</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#country">country</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#postalCode">postalCode</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#province">province</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="address"></a>
                                        <span class="name"><b>address</b><a href="#address"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>address:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="city"></a>
                                        <span class="name"><b>city</b><a href="#city"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>city:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="country"></a>
                                        <span class="name"><b>country</b><a href="#country"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>country:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="postalCode"></a>
                                        <span class="name"><b>postalCode</b><a href="#postalCode"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>postalCode:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="province"></a>
                                        <span class="name"><b>province</b><a href="#province"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>province:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>

    <div class="tab-pane fade " id="c-readme">
        <p><h2 id="design-guidelines">Design Guidelines</h2>
<p>todo</p>
</p>
    </div>

    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  Component,
  Input,
  Output,
  EventEmitter,
  OnChanges,
  forwardRef,
  OnInit
} from &#x27;@angular/core&#x27;;
import { ControlContainer, ControlValueAccessor, NgForm, NG_VALUE_ACCESSOR } from &#x27;@angular/forms&#x27;;
import { Base } from &#x27;../../models/base&#x27;;
import { GeoAddressResult } from &#x27;../../services/geocoder.service&#x27;;
import { Address } from &#x27;../../models/address.model&#x27;;
import { CountryList, CANADA, COUNTRY_LIST } from &#x27;../country/country.component&#x27;;
import { ProvinceList, BRITISH_COLUMBIA, PROVINCE_LIST } from &#x27;../province/province.component&#x27;;

export interface AddrLabelList {
  address1?: string;
  address2?: string;
  address3?: string;
  city?: string;
  province?: string;
  country?: string;
  postalCode?: string;
}

export interface Maxlengths {
  address?: string;
  city?: string;
  province?: string;
  country?: string;
  postalCode?: string;
}

export interface ReadOnlyFields {
  address?: boolean;
  city?: boolean;
  province?: boolean;
  country?: boolean;
  postalCode?: boolean;
}

/**
 *
 * Note - This component REQUIRES that &#x60;HttpClientModule&#x60; is registered in your NgModule.
 */
@Component({
  selector: &#x27;common-address&#x27;,
  templateUrl: &#x27;./address.component.html&#x27;,
  /* Re-use the same ngForm that it&#x27;s parent is using. The component will show
   * up in its parents &#x60;this.form&#x60;, and will auto-update &#x60;this.form.valid&#x60;
   */
  viewProviders: [
    { provide: ControlContainer, useExisting: forwardRef(() &#x3D;&gt; NgForm) }
  ],
  providers: [
    { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() &#x3D;&gt; AddressComponent) }
  ]
})
export class AddressComponent extends Base
  implements OnInit, OnChanges, ControlValueAccessor {

  /* Disable all fields by sending in boolean,
   * disable specific fields by sending in ReadOnlyFields structure
   */
  @Input() disabled: boolean | ReadOnlyFields &#x3D; false;
  @Input() isRequired: boolean &#x3D; false;
  @Input() countryList: CountryList[] &#x3D; COUNTRY_LIST;
  @Input() defaultCountry: string &#x3D; CANADA;
  @Input() provinceList: ProvinceList[] &#x3D; PROVINCE_LIST;
  @Input() defaultProvince: string &#x3D; BRITISH_COLUMBIA;
  @Input() disableGeocoder: boolean &#x3D; false; // This should eventually be refactored to &#x60;disableAddressValidator&#x60;. Leaving it for compatibility.
  @Input() labels: AddrLabelList;
  @Input() maxlengths: Maxlengths;
  @Input() bcOnly: boolean &#x3D; false;
  @Input() addressServiceUrl: string;

  @Input()
  set address(val: Address) {
    if (val) {
      this.addr &#x3D; val;
    }
  }
  get address(): Address {
    return this.addr;
  }

  @Output() addressChange: EventEmitter&lt;Address&gt; &#x3D; new EventEmitter&lt;Address&gt;();
  /**
   * If true, adds a plus icon next to street and enables users to add a second
   * address line.  This value binds to &#x60;address.addressLine2&#x60;
   */
  @Input() allowExtralines: boolean &#x3D; false;

  addr: Address;
  provList: ProvinceList[];
  showLine2 &#x3D; false;
  showLine3 &#x3D; false;

  // Labels defaulted to MSP
  addrLabels: AddrLabelList &#x3D;  {
    address1: &#x27;Full street address, rural route, PO box or general delivery&#x27;,
    address2: &#x27;Address Line 2&#x27;,
    address3: &#x27;Address Line 3&#x27;,
    city: &#x27;City&#x27;,
    province: &#x27;Province or state&#x27;,
    country: &#x27;Country&#x27;,
    postalCode: &#x27;Postal Code or Zip Code&#x27;
  };

  // Lengths defaulted to MSP
  fieldMaxLenghts: Maxlengths &#x3D; {
    address: &#x27;25&#x27;,
    city: &#x27;25&#x27;,
    province: &#x27;25&#x27;,
    country: &#x27;250&#x27;,
    postalCode: &#x27;25&#x27;
  };

  readOnlyFields: ReadOnlyFields &#x3D; {
    address: false,
    city: false,
    province: false,
    country: false,
    postalCode: false,
  };

  _onChange &#x3D; (_: any) &#x3D;&gt; { };
  _onTouched &#x3D; (_: any) &#x3D;&gt; { };

  constructor() {
    super();
  }

  ngOnInit() {

    // console.log( &#x27;address: &#x27;, this.bcOnly );

    this.setLabels();
    this.setMaxlengths();
    this.setReadOnlyFields();

    if (this.addr) {

      if (!this.addr.country) {
        this.addr.country &#x3D; this.setDefaultCountryAsOption();
      } else {
        // If string for country submitted, need to find code to display value in select box
        this.addr.country &#x3D; this.findCountryCode( this.addr.country );
      }

      if (!this.addr.province) {
        this.addr.province &#x3D; this.setDefaultProvinceAsOption(this.addr.country);
      }

      // Make sure addressLine2 is visible if there is data persisted to display there.
      if (this.allowExtralines) {
        if (this.addr.addressLine2) {
          this.addLine(2);
        }

        if (this.addr.addressLine3) {
          this.addLine(3);
        }
      }
    }

    this.updateProvList();
  }

  /**
   * Set country province blank
   * @param value
   */
  setCountry(value: string) {
    this.addr.province &#x3D; this.setDefaultProvinceAsOption( value );
    this.addr.country &#x3D; value;
    this.updateProvList();

   if ( this.isCanada() ) {
      // If Canada, clear postal code to display mask
      this.addr.postal &#x3D; &#x27;&#x27;;
    }

    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  setProvince(value: string) {
    this.addr.province &#x3D; value;
    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  setStreetAddress(value: string) {
    this.addr.addressLine1 &#x3D; value;
    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  setCity(value: string) {
    this.addr.city &#x3D; value;
    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  /**
   * Sets string after converted upper case
   * @param text
   */
  setPostalCode(value: string) {
    this.addr.postal &#x3D; value;
    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  isCanada(): boolean {
    return this.addr &amp;&amp; CANADA &#x3D;&#x3D;&#x3D; this.addr.country;
  }

  ngOnChanges(changes) {
    if (changes[&#x27;countryList&#x27;] &amp;&amp; changes[&#x27;countryList&#x27;].currentValue) {

      if (this.addr &amp;&amp; !this.addr.country) {
        // Set defaults
        this.addr.country &#x3D; this.setDefaultCountryAsOption();

        // Set defaults
        this.addr.province &#x3D; this.setDefaultProvinceAsOption(this.addr.country);
      }
      this.updateProvList();
    }
    if (changes[&#x27;provinceList&#x27;] &amp;&amp; changes[&#x27;provinceList&#x27;].currentValue) {
      if (this.addr &amp;&amp; !this.addr.province) {
        // Set defaults
        this.addr.province &#x3D; this.setDefaultProvinceAsOption(this.addr.country);
      }
      this.updateProvList();
    }
  }

  addLine(line: 2 | 3 &#x3D; null) {

    // Add lines in order
    if (line &#x3D;&#x3D;&#x3D; null) {
      if (!this.showLine2) {
        this.showLine2 &#x3D; true;
      } else if (!this.showLine3) {
        this.showLine3 &#x3D; true;
      }
    } else {
      // Add specific line number
      const lookup &#x3D; &#x60;showLine${line}&#x60;;
      this[lookup] &#x3D; true;
    }
  }

  removeLine(line: 2 | 3) {
    // We can remove lines in any order, depending on user input
    // Dynamically lookup variable based on line number input.
    const lookup &#x3D; &#x60;showLine${line}&#x60;;
    this[lookup] &#x3D; false;

    // TODO - Need to clear the data in the appropriate field, just null/undefined it out.
    const addrLookup &#x3D; &#x60;addressLine${line}&#x60;;
    this.address[addrLookup] &#x3D; undefined;
  }

  /**
   * Updates the provList variable. Values must be stored in a variable and not
   * accessed via function invocation for performance.
   */
  private updateProvList() {
    if (!this.provinceList) { return; } // When data is async and hasn&#x27;t loaded
    this.provList &#x3D; this.provinceList
      .map(prov &#x3D;&gt; {
        if (prov.country &#x3D;&#x3D;&#x3D; this.addr.country) {
          return prov;
        }
      })
      .filter(x &#x3D;&gt; x);
  }

  /**
   * Sets the default province option value
   */
  private setDefaultProvinceAsOption(country: string): string {
    const provObj &#x3D; !this.provinceList ? null : this.provinceList.find(
      val &#x3D;&gt; (val.provinceCode &#x3D;&#x3D;&#x3D; this.defaultProvince ||
        val.description &#x3D;&#x3D;&#x3D; this.defaultProvince) &amp;&amp;
        val.country &#x3D;&#x3D;&#x3D; country
    );
    return (provObj ? provObj.provinceCode : &#x27;&#x27;);
  }

  private findProvinceDescription(prov: string): string {
    const provObj &#x3D; !this.provinceList ? null : this.provinceList.find(
      val &#x3D;&gt; val.provinceCode &#x3D;&#x3D;&#x3D; prov ||
        val.description &#x3D;&#x3D;&#x3D; prov
    );
    return (provObj ? provObj.description : null);
  }

  /**
   * Set country to default
   * Search uses country code or country name to find item is list.
   */
  private setDefaultCountryAsOption(): string {
    return this.findCountryCode( this.defaultCountry );
  }

  private findCountryCode( country: string ): string {
    const countryObj &#x3D; !this.countryList
      ? null
      : this.countryList.find(
        val &#x3D;&gt;
          val.countryCode &#x3D;&#x3D;&#x3D; country ||
          val.description &#x3D;&#x3D;&#x3D; country
      );
    return countryObj ? countryObj.countryCode : null;
  }

  get useAddressValidator(): boolean {
    if (this.disableGeocoder) {
      return false;
    }
    return this.isCanada() &amp;&amp; BRITISH_COLUMBIA &#x3D;&#x3D;&#x3D; this.addr.province;
  }

  // Only BC addresses therefore no need to copy province into structure.
  setAddress(data: GeoAddressResult) {
    this.addr.addressLine1 &#x3D; data.street;
    this.addr.city &#x3D; data.city;
    this.addr.province &#x3D; data.province;
    this.addr.country &#x3D; data.country;
    this.addressChange.emit(this.addr);
  }

  selectSuggestedAddress(address: Address) {
    if (!address.street &amp;&amp; !address.city &amp;&amp; !address.postal) {
      return;
    }
    if (this.bcOnly &amp;&amp; address.province !&#x3D; BRITISH_COLUMBIA) {
      alert(&#x27;Please select a valid BC address.&#x27;);
      return;
    }
    this.addr.addressLine1 &#x3D; address.street;
    this.addr.city &#x3D; address.city;
    this.addr.postal &#x3D; address.postal;
    if (!this.bcOnly) {
      this.addr.province &#x3D; address.province;
    }
    this._onChange(this.addr);
    this.addressChange.emit(this.addr);
    this._onTouched(this.addr);
  }

  writeValue( value: Address) {
    if ( value ) {
      this.addr &#x3D; value;
    }
  }

  registerOnChange(fn: any): void {
    this._onChange &#x3D; fn;
  }

  registerOnTouched(fn: any): void {
    this._onTouched &#x3D; fn;
  }

  setDisabledState(isDisabled: boolean): void {
    this.disabled &#x3D; isDisabled;
    this.setReadOnlyFields();
  }

  private setLabels() {
    if ( this.labels ) {
      Object.keys(this.labels).map( x &#x3D;&gt; this.addrLabels[x] &#x3D; this.labels[x] );
    }
  }

  private setMaxlengths() {
    if ( this.maxlengths ) {
      Object.keys(this.fieldMaxLenghts).map( x &#x3D;&gt; this.maxlengths[x] &#x3D; this.fieldMaxLenghts[x]);
    }
  }

  private setReadOnlyFields() {
    if ( typeof this.disabled &#x3D;&#x3D;&#x3D; &#x27;boolean&#x27; ) {
      Object.keys(this.readOnlyFields).map( x &#x3D;&gt; this.readOnlyFields[x] &#x3D; this.disabled );
    } else {
      Object.keys(this.disabled).map( x &#x3D;&gt; this.readOnlyFields[x] &#x3D; this.disabled[x] );
    }
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ReadOnlyFields.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
