<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>moh-common-lib</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/stripe.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">moh-common-lib</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>AddressResult</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/common/lib/components/address-validator/address-validator.component.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>For TemplateForms, pass in an Address and recieve an Address</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#AddressComplete">AddressComplete</a>
                                </li>
                                <li>
                                        <a href="#AddressLines">AddressLines</a>
                                </li>
                                <li>
                                        <a href="#Country">Country</a>
                                </li>
                                <li>
                                        <a href="#DeliveryAddressLines">DeliveryAddressLines</a>
                                </li>
                                <li>
                                        <a href="#HouseNumber">HouseNumber</a>
                                </li>
                                <li>
                                        <a href="#Locality">Locality</a>
                                </li>
                                <li>
                                        <a href="#PostalCode">PostalCode</a>
                                </li>
                                <li>
                                        <a href="#Province">Province</a>
                                </li>
                                <li>
                                        <a href="#Street">Street</a>
                                </li>
                                <li>
                                        <a href="#SubBuilding">SubBuilding</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="AddressComplete"></a>
                                        <span class="name"><b>AddressComplete</b><a href="#AddressComplete"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>AddressComplete:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>String from the API that includes street, city, province, and country. </p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="AddressLines"></a>
                                        <span class="name"><b>AddressLines</b><a href="#AddressLines"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>AddressLines:     <code>Array&lt;string&gt;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Array&lt;string&gt;</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="Country"></a>
                                        <span class="name"><b>Country</b><a href="#Country"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>Country:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="DeliveryAddressLines"></a>
                                        <span class="name"><b>DeliveryAddressLines</b><a href="#DeliveryAddressLines"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>DeliveryAddressLines:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="HouseNumber"></a>
                                        <span class="name"><b>HouseNumber</b><a href="#HouseNumber"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>HouseNumber:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="Locality"></a>
                                        <span class="name"><b>Locality</b><a href="#Locality"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>Locality:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="PostalCode"></a>
                                        <span class="name"><b>PostalCode</b><a href="#PostalCode"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>PostalCode:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="Province"></a>
                                        <span class="name"><b>Province</b><a href="#Province"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>Province:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="Street"></a>
                                        <span class="name"><b>Street</b><a href="#Street"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>Street:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="SubBuilding"></a>
                                        <span class="name"><b>SubBuilding</b><a href="#SubBuilding"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>SubBuilding:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, Input, ChangeDetectorRef, Output, EventEmitter, Optional, Self } from &#x27;@angular/core&#x27;;
import { Subject, Observable, of, throwError } from &#x27;rxjs&#x27;;
import { debounceTime, distinctUntilChanged, switchMap, map, catchError } from &#x27;rxjs/operators&#x27;;
import { TypeaheadMatch } from &#x27;ngx-bootstrap/typeahead&#x27;;
import { HttpClient, HttpErrorResponse, HttpParams } from &#x27;@angular/common/http&#x27;;
import { NgControl, ControlValueAccessor } from &#x27;@angular/forms&#x27;;
import { Address } from &#x27;../../models/address.model&#x27;;
import { AbstractFormControl } from &#x27;../../models/abstract-form-control&#x27;;
import { ErrorMessage, LabelReplacementTag } from &#x27;../../models/error-message.interface&#x27;;
import { deburr } from &#x27;../../../helpers/deburr&#x27;;



/**
 * For TemplateForms, pass in an Address and recieve an Address
 * @example
 *           &lt;common-address-validator
 *               label&#x3D;&#x27;Physical Address&#x27;
 *               [(ngModel)]&#x3D;&quot;myAddress&quot;&gt;
 *           &lt;/common-address-validator&gt;
 *
 * @note
 * For ReactiveForms, pass in a string and recieve a string.  If you need the
 * Address object you can use (select) in addition.
 *
 * @example
 *           &lt;common-address-validator
 *              label&#x3D;&#x27;Physical Address&#x27;
 *              formControlName&#x3D;&quot;address&quot;
 *              (select)&#x3D;&quot;getAddressObject($event)&quot;&gt;
 *          &lt;/common-address-validator&gt;
 */

export interface AddressResult {
  /** String from the API that includes street, city, province, and country. */
  AddressComplete: string;
  HouseNumber: string;
  SubBuilding: string;
  Street: string;
  Locality: string;
  DeliveryAddressLines: string;
  AddressLines: Array&lt;string&gt;;
  // Set to defaults in response
  Country: string;
  Province: string;
  PostalCode: string;
}

@Component({
  selector: &#x27;common-address-validator&#x27;,
  templateUrl: &#x27;./address-validator.component.html&#x27;,
  styleUrls: [&#x27;./address-validator.component.scss&#x27;]
})
export class AddressValidatorComponent extends AbstractFormControl implements OnInit, ControlValueAccessor {

  @Input() label: string &#x3D; &#x27;Address Lookup&#x27;;
  @Input() address: string;
  @Input() serviceUrl: string;
  @Input() populateAddressOnSelect: boolean &#x3D; false;
  @Output() addressChange: EventEmitter&lt;string&gt; &#x3D; new EventEmitter&lt;string&gt;();
  @Output() select: EventEmitter&lt;Address&gt; &#x3D; new EventEmitter&lt;Address&gt;();

  @Input() maxlength: string &#x3D; &#x27;255&#x27;;

  _defaultErrMsg: ErrorMessage &#x3D; {
    required:  LabelReplacementTag + &#x27; is required.&#x27;,
    invalidChar: LabelReplacementTag + &#x27; must contain letters and numbers, and may include special characters such as a hyphen, period, apostrophe, number sign, ampersand, forward slash, and blank characters.&#x27;
  };
  /** The string in the box the user has typed */
  public search: string;
  /** Is the request still in progress? */
  public isTypeaheadLoading: boolean &#x3D; false;
  /** has returned and has no results, an empty array. */
  public hasNoResults: boolean &#x3D; false;
  public hasError: boolean &#x3D; false;

  /** Similar to this.address, but we can null it when user is searching for new addresses */
  public selectedAddress: boolean &#x3D; false;
  /** The list of results, from API, that is passed to the typeahead list */
  public typeaheadList$: Observable&lt;AddressResult[]&gt; &#x3D; of([]); // Result from address lookup
  /** The subject that triggers on user text input and gets typeaheadList$ to update.  */
  private searchText$ &#x3D; new Subject&lt;string&gt;();

  _onChange &#x3D; (_: any) &#x3D;&gt; {};
  _onTouched &#x3D; (_?: any) &#x3D;&gt; {};

  constructor(@Optional() @Self() public controlDir: NgControl,
              private cd: ChangeDetectorRef,
              protected http: HttpClient) {
    super();
    if ( controlDir ) {
      controlDir.valueAccessor &#x3D; this;
    }
  }

  ngOnInit() {
    super.ngOnInit();
    
    this.typeaheadList$ &#x3D; this.searchText$.pipe(
      debounceTime(500),
      distinctUntilChanged(),
      // Trigger the network request, get results
      switchMap(searchPhrase &#x3D;&gt; this.lookup(searchPhrase)),
      catchError(err &#x3D;&gt; this.onError(err))
    );
  }

  onError(err): Observable&lt;AddressResult[]&gt; {
    this.hasError &#x3D; true;
    // Empty array simulates no result response, nothing for typeahead to iterate over
    return of([]);
  }

  onLoading(val: boolean): void {
    this.isTypeaheadLoading &#x3D; val;
    this.hasError &#x3D; false;
  }

  // Note - this will fire after an onError as well
  onNoResults(val: boolean): void {
    // If we have results, the error has resolved (e.g. network has re-connected)
    if (val &#x3D;&#x3D;&#x3D; false) {
      this.hasError &#x3D; false;
    }

    this.hasNoResults &#x3D; val;
  }

  onSelect(event: TypeaheadMatch): void {

    const data: AddressResult &#x3D; event.item;

    // Output string to FormControl. If street is more than the max length shorten
    const stripped &#x3D; data.AddressLines ? this.stripStringToMaxLength(deburr(data.AddressLines[0])) : null;

    const addr &#x3D; new Address();
    addr.unitNumber &#x3D; deburr(data.SubBuilding);
    addr.streetNumber &#x3D; deburr(data.HouseNumber);
    addr.streetName &#x3D; deburr(data.Street);
    addr.city &#x3D; deburr(data.Locality);
    addr.country &#x3D; data.Country;
    addr.province &#x3D; data.Province;
    addr.street &#x3D; stripped;
    addr.postal &#x3D; deburr(data.PostalCode);
    addr.addressLine1 &#x3D; data.AddressLines &amp;&amp; data.AddressLines[0] ? deburr(data.AddressLines[0]) : null;
    addr.addressLine2 &#x3D; data.AddressLines &amp;&amp; data.AddressLines[1] ? deburr(data.AddressLines[1]) : null;
    addr.addressLine3 &#x3D; data.AddressLines &amp;&amp; data.AddressLines[2] ? deburr(data.AddressLines[2]) : null;
    // Save and emit Address for (select)
    this.selectedAddress &#x3D; true;
    this.select.emit(addr);

    // For template forms, must explicitly set &#x60;search&#x60; value upon selecting an item.
    if (this.populateAddressOnSelect) {
      this.search &#x3D; stripped;
    }
    this._onChange(stripped);
  }

  onKeyUp(event: KeyboardEvent): void {
    // Filter out &#x27;enter&#x27; and other similar keyboard events that can trigger
    // when user is selecting a typeahead option instead of entering new text.
    // Without this filter, we do another HTTP request + force disiplay the UI
    // for now reason
    if (event.keyCode &#x3D;&#x3D;&#x3D; 13 || event.keyCode &#x3D;&#x3D;&#x3D; 9) {  // enter &amp; tab
      return;
    }
    // Clear out selection
    this.selectedAddress &#x3D; false;
    this.searchText$.next(this.search);
  }

  onBlur(event): void {
    this._onTouched();
    if (this.search) {
      this._onChange(this.search);
    }
  }

  writeValue( value: any ): void {
    if ( value  !&#x3D;&#x3D; undefined ) {
      this.search &#x3D; value;
    }
  }

  setSearchValue(value: any) {
    this._onChange(value);
    this._onTouched(value);
  }

  // Register change function
  registerOnChange( fn: any ): void {
    this._onChange &#x3D; fn;
  }

  // Register touched function
  registerOnTouched( fn: any ): void {
    this._onTouched &#x3D; fn;
  }

  private stripStringToMaxLength(str: string) {
    const maxlength &#x3D; parseInt(this.maxlength, 10);
    return str.slice(0, maxlength);
  }

  lookup(address: string): Observable&lt;AddressResult[]&gt; {
    const params &#x3D; new HttpParams()
                    .set(&#x27;address&#x27;, address);

    return this.http.get(this.serviceUrl, {
      params: params
    }).pipe(map(this.processResponse));
  }

  /**
   * Formats the response from ADDRESS_URL, trimming irrelevant fields.
   *
   * This works for other requests for the same API too, however it may error
   * out on some items if matchPrecisionNot is not set.
   *
   * @param obj The response from ADDRESS_URL
   */
  protected processResponse(obj): AddressResult[] {
    return obj.Address.map(feature &#x3D;&gt; {
      const props &#x3D; feature;
      const Locality &#x3D; props.Locality;
      const AddressComplete &#x3D; props.AddressComplete;
      const AddressLines &#x3D; props.AddressLines;
      const DeliveryAddressLines &#x3D; props.DeliveryAddressLines;
      const Province &#x3D; props.Province;
      const Country &#x3D; props.Country;
      const PostalCode &#x3D; props.PostalCode;
      const SubBuilding &#x3D; props.SubBuilding;
      const Street &#x3D; props.Street;
      const HouseNumber &#x3D; props.HouseNumber;

      return {
        AddressComplete,
        AddressLines,
        SubBuilding,
        Street,
        HouseNumber,
        Locality,
        DeliveryAddressLines,
        Province,
        Country,
        PostalCode
      };
    });
  }

  protected handleError(error: HttpErrorResponse) {
    console.error(&#x27;AddressValidator network error&#x27;, { error });
    return throwError(&#x27;AddressValidator error&#x27;);
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'AddressResult.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
